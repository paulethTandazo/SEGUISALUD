import{a as fe}from"./chunk-UALI6JCB.js";import{A as te,B as ne,C as ie,E as oe,F as ae,G as re,b as H,c as W,d as B,e as $,h as q,i as Y,k as G,l as J,n as K,o as Q,p as U,q as X,w as Z,x as ee}from"./chunk-YNM62QJP.js";import{a as _e}from"./chunk-HEXEI4CB.js";import"./chunk-SK3Z2GDI.js";import"./chunk-QUJFQN2Y.js";import"./chunk-4JVC5FNE.js";import"./chunk-IH6E6YVF.js";import"./chunk-6Z6MJZ6J.js";import"./chunk-62QDCRAJ.js";import"./chunk-NWECPXNP.js";import"./chunk-I26NZKD3.js";import"./chunk-BMJVVMK5.js";import"./chunk-33R7V3D5.js";import"./chunk-I5OWKS3S.js";import"./chunk-SZ3K3J3X.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-3UBM7ASS.js";import"./chunk-CKP3SGE2.js";import"./chunk-KYKLHCVV.js";import{F as ge,H as pe,Q as he,R as ue,a as ce,c as le,j as se,k as de,l as me}from"./chunk-K7KBPFVH.js";import{$ as C,C as g,D as i,E as o,F as h,L as k,M as u,N as P,Ta as L,U as O,Ua as V,W as l,X as v,Xa as j,Y as T,Ya as z,Z as I,_ as b,aa as M,ca as E,da as F,ga as R,ha as D,j as w,ja as A,k as y,ka as N,r,t as f,v as S,z as _}from"./chunk-NRXC3TAV.js";import"./chunk-XIBDAHXH.js";import"./chunk-XOKKKZEN.js";import"./chunk-N6OJSQJW.js";import"./chunk-H3HFVQ5W.js";import"./chunk-GYLY2RJE.js";import"./chunk-M2X7KQLB.js";import"./chunk-XTVTS2NW.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g as p}from"./chunk-2R6CW7ES.js";var x=_e("LocalNotifications",{web:()=>import("./chunk-M6RURRQA.js").then(a=>new a.LocalNotificationsWeb)});function be(a,s){if(a&1&&(i(0,"ion-select-option",25),l(1),o()),a&2){let d=s.$implicit;g("value",d.nombre),r(),I(" ",d.nombre," (",d.cantidadActual," rest.) ")}}function Ce(a,s){if(a&1&&(i(0,"ion-badge",34),l(1),o()),a&2){let d=P().$implicit;r(),T(" ",d.medicina," ")}}function Me(a,s){if(a&1){let d=k();i(0,"ion-item",26)(1,"div",27)(2,"div",28),h(3,"ion-icon",29),o(),i(4,"div",30)(5,"h2"),l(6),o(),i(7,"p"),l(8),E(9,"date"),o(),_(10,Ce,2,1,"ion-badge",31),o(),i(11,"ion-button",32),u("click",function(){let t=w(d).$implicit,n=P();return y(n.completarTarea(t))}),h(12,"ion-icon",33),o()()()}if(a&2){let d=s.$implicit;r(),O("background",d.color),r(5),v(d.texto),r(2),v(F(9,5,d.fecha,"short")),r(2),g("ngIf",d.medicina)}}function xe(a,s){a&1&&(i(0,"div",35)(1,"p"),l(2,"No tienes dosis pendientes."),o()())}var Le=(()=>{let s=class s{constructor(e,t,n,m){this.alertCtrl=e,this.toastCtrl=t,this.dataService=n,this.platform=m,this.fechaSeleccionada=this.getFechaLocalISO(),this.nuevoRecordatorio="",this.listaRecordatorios=[],this.listaMedicamentos=[],this.medicamentoVinculado="",this.coloresFlashcard=["#ffcdd2","#b3e5fc","#c8e6c9","#ffe0b2","#e1bee7"],this.indiceColor=1,this.colorActual=this.coloresFlashcard[this.indiceColor],this.audio=new Audio("assets/alarm.mp3"),this.miCorreo="usuario@seguisalud.com",ce({checkmarkCircleOutline:se,trashOutline:ue,notificationsOutline:pe,alarmOutline:le,createOutline:me,colorPaletteOutline:de,timeOutline:he,medkitOutline:ge})}ngOnInit(){return p(this,null,function*(){this.dataService.recordatorios$.subscribe(e=>{this.listaRecordatorios=e}),this.dataService.medicamentos$.subscribe(e=>{this.listaMedicamentos=e}),this.platform.is("hybrid")?(yield x.requestPermissions(),yield x.createChannel({id:"alarmas_salud",name:"Alarmas de Medicaci\xF3n",importance:5,sound:"res://platform_default",visibility:1,vibration:!0})):(Notification.permission!=="granted"&&Notification.requestPermission(),this.iniciarRelojWeb())})}ngOnDestroy(){this.intervaloWeb&&clearInterval(this.intervaloWeb)}getFechaLocalISO(){let e=new Date,t=e.getTimezoneOffset()*6e4;return new Date(e.getTime()-t).toISOString().slice(0,-1)}cambiarColor(){this.indiceColor++,this.indiceColor>=this.coloresFlashcard.length&&(this.indiceColor=0),this.colorActual=this.coloresFlashcard[this.indiceColor]}alSeleccionarMedicamento(){this.medicamentoVinculado&&(this.nuevoRecordatorio=`Tomar dosis de ${this.medicamentoVinculado}`)}cambioFecha(e){this.fechaSeleccionada=e.detail.value}agregarRecordatorio(){return p(this,null,function*(){if(this.nuevoRecordatorio.trim().length<1)return;let e=new Date(this.fechaSeleccionada),t={id:new Date().getTime(),texto:this.nuevoRecordatorio,fecha:this.fechaSeleccionada,color:this.colorActual,medicina:this.medicamentoVinculado,yaSono:!1};this.dataService.agregarRecordatorio(t),this.platform.is("hybrid")&&(yield this.programarNotificacionNativa(t,e)),yield this.mostrarAlertaConfirmacion(t.texto,t.fecha),this.nuevoRecordatorio="",this.medicamentoVinculado=""})}completarTarea(e){return p(this,null,function*(){this.audio.pause(),this.audio.currentTime=0,this.dataService.eliminarRecordatorio(e.id),e.medicina&&this.dataService.descontarDosis(e.medicina);let t="\u2705 Dosis completada.";e.medicina&&(t+=` Inventario de ${e.medicina} actualizado.`),(yield this.toastCtrl.create({message:t,duration:3e3,position:"bottom",color:"success"})).present()})}programarNotificacionNativa(e,t){return p(this,null,function*(){yield x.schedule({notifications:[{title:"\u{1F48A} Hora de tu medicaci\xF3n",body:e.texto,id:e.id,schedule:{at:t},channelId:"alarmas_salud",sound:"res://platform_default"}]})})}iniciarRelojWeb(){this.intervaloWeb=setInterval(()=>{this.verificarAlarmas()},2e3)}verificarAlarmas(){let e=new Date;this.listaRecordatorios.forEach(t=>{let n=new Date(t.fecha);!t.yaSono&&this.esMismoMinuto(e,n)&&(t.yaSono=!0,this.activarAlarmaWeb(t))})}esMismoMinuto(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()}activarAlarmaWeb(e){return p(this,null,function*(){try{this.audio.loop=!0,yield this.audio.play()}catch{console.log("Audio bloqueado")}yield(yield this.alertCtrl.create({header:"\xA1ALARMA!",subHeader:"Hora de tu medicamento",message:e.texto,backdropDismiss:!1,buttons:[{text:"\u2705 Ya me la tom\xE9 (Apagar)",handler:()=>{this.completarTarea(e)}}],cssClass:"alarm-alert"})).present()})}mostrarAlertaConfirmacion(e,t){return p(this,null,function*(){let n=new Date(t).toLocaleString();yield(yield this.alertCtrl.create({header:"\xA1Recordatorio Guardado!",message:`Se ha programado: ${e}

Para el: ${n}

Respaldo enviado a:
${this.miCorreo}`,buttons:["Entendido"],cssClass:"custom-alert"})).present()})}};s.\u0275fac=function(t){return new(t||s)(f(oe),f(ae),f(fe),f(z))},s.\u0275cmp=S({type:s,selectors:[["app-tab2"]],decls:37,vars:11,consts:[[1,"ion-no-border",3,"translucent"],[2,"--background","#f8f9fa"],[2,"color","#333","font-weight","700"],[1,"ion-padding",3,"fullscreen"],[1,"flashcard-container"],[1,"card-header"],["fill","clear",1,"btn-color",3,"click"],["name","color-palette-outline","slot","icon-only"],[1,"input-group"],["name","medkit-outline",2,"vertical-align","middle"],["interface","popover","placeholder","Selecciona uno...",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["rows","2","placeholder","Ej. Recordatorio para dosis de...",3,"ngModelChange","ngModel"],[1,"mini-calendar"],[1,"calendar-label"],["name","time-outline"],["presentation","date-time","size","cover",3,"ngModelChange","ionChange","preferWheel","ngModel"],["expand","block",1,"btn-save-card",3,"click"],["name","notifications-outline","slot","start"],[1,"list-wrapper"],[2,"padding-left","0","margin-bottom","10px"],[2,"font-size","18px","font-weight","700","color","#333"],["lines","none",2,"background","transparent"],["class","task-item",4,"ngFor","ngForOf"],["class","ion-text-center ion-padding","style","color: #999;",4,"ngIf"],[3,"value"],[1,"task-item"],[1,"task-card"],[1,"icon-box"],["name","alarm-outline"],[1,"task-info"],["color","light","style","margin-top: 5px; opacity: 0.8",4,"ngIf"],["fill","clear",1,"btn-check",3,"click"],["name","checkmark-circle-outline","slot","icon-only"],["color","light",2,"margin-top","5px","opacity","0.8"],[1,"ion-text-center","ion-padding",2,"color","#999"]],template:function(t,n){t&1&&(i(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title",2),l(3,"Mi Agenda"),o()()(),i(4,"ion-content",3)(5,"div",4)(6,"div",5)(7,"h3"),l(8,"Nueva Dosis"),o(),i(9,"ion-button",6),u("click",function(){return n.cambiarColor()}),h(10,"ion-icon",7),o()(),i(11,"div",8)(12,"ion-label"),h(13,"ion-icon",9),l(14," Medicamento del Botiqu\xEDn "),o(),i(15,"ion-select",10),M("ngModelChange",function(c){return C(n.medicamentoVinculado,c)||(n.medicamentoVinculado=c),c}),u("ionChange",function(){return n.alSeleccionarMedicamento()}),_(16,be,2,3,"ion-select-option",11),o()(),i(17,"div",8)(18,"ion-label"),l(19,"Descripci\xF3n"),o(),i(20,"ion-textarea",12),M("ngModelChange",function(c){return C(n.nuevoRecordatorio,c)||(n.nuevoRecordatorio=c),c}),o()(),i(21,"div",13)(22,"div",14),h(23,"ion-icon",15),i(24,"span"),l(25,"Fecha y Hora"),o()(),i(26,"ion-datetime",16),M("ngModelChange",function(c){return C(n.fechaSeleccionada,c)||(n.fechaSeleccionada=c),c}),u("ionChange",function(c){return n.cambioFecha(c)}),o()(),i(27,"ion-button",17),u("click",function(){return n.agregarRecordatorio()}),h(28,"ion-icon",18),l(29," Programar "),o()(),i(30,"div",19)(31,"ion-list-header",20)(32,"ion-label",21),l(33,"Pr\xF3ximas Dosis"),o()(),i(34,"ion-list",22),_(35,Me,13,8,"ion-item",23)(36,xe,3,0,"div",24),o()()()),t&2&&(g("translucent",!0),r(4),g("fullscreen",!0),r(),O("background",n.colorActual),r(10),b("ngModel",n.medicamentoVinculado),r(),g("ngForOf",n.listaMedicamentos),r(4),b("ngModel",n.nuevoRecordatorio),r(6),g("preferWheel",!0),b("ngModel",n.fechaSeleccionada),r(9),g("ngForOf",n.listaRecordatorios),r(),g("ngIf",n.listaRecordatorios.length===0))},dependencies:[re,B,$,q,Y,G,J,K,Q,U,X,Z,ee,te,ne,ie,H,W,N,R,D,j,L,V,A],styles:["ion-content[_ngcontent-%COMP%]{--background: #f8f9fa}.flashcard-container[_ngcontent-%COMP%]{border-radius:25px;padding:20px;box-shadow:0 10px 20px #00000014;margin-bottom:30px;transition:background .3s ease}.flashcard-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.flashcard-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:800;color:#333;opacity:.8}.flashcard-container[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .btn-color[_ngcontent-%COMP%]{--color: #333;background:#fff6;border-radius:50%;width:40px;height:40px;--padding-start: 0;--padding-end: 0}.flashcard-container[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{background:#fff9;border-radius:15px;padding:10px 15px;margin-bottom:15px}.flashcard-container[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px;color:#666;font-weight:600;display:block;margin-bottom:5px}.flashcard-container[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%], .flashcard-container[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-start: 0;font-weight:600;color:#222}.flashcard-container[_ngcontent-%COMP%]   .mini-calendar[_ngcontent-%COMP%]{background:#fffc;border-radius:20px;padding:10px;margin-bottom:20px}.flashcard-container[_ngcontent-%COMP%]   .mini-calendar[_ngcontent-%COMP%]   .calendar-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;padding-left:10px;margin-bottom:5px;color:#555;font-size:13px;font-weight:600}.flashcard-container[_ngcontent-%COMP%]   .mini-calendar[_ngcontent-%COMP%]   ion-datetime[_ngcontent-%COMP%]{--background: transparent;border-radius:15px;margin:0 auto}.flashcard-container[_ngcontent-%COMP%]   .btn-save-card[_ngcontent-%COMP%]{--background: #333;--color: white;--border-radius: 15px;font-weight:700;height:50px;--box-shadow: 0 4px 10px rgba(0,0,0,.2)}.list-wrapper[_ngcontent-%COMP%]{padding-bottom:40px}.task-item[_ngcontent-%COMP%]{--background: transparent;--padding-start: 0;--inner-padding-end: 0;margin-bottom:15px}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]{width:100%;padding:15px;border-radius:18px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 4px 8px #0000000d}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .icon-box[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:50%;background:#ffffff80;color:#333;display:flex;align-items:center;justify-content:center;margin-right:15px}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .icon-box[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .task-info[_ngcontent-%COMP%]{flex:1}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .task-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:700;margin:0 0 4px;color:#222}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .task-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;color:#444;margin:0;font-weight:500}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .btn-check[_ngcontent-%COMP%]{--color: #222;background:#ffffff80;border-radius:50%;width:40px;height:40px;--padding-start: 0;--padding-end: 0}.task-item[_ngcontent-%COMP%]   .task-card[_ngcontent-%COMP%]   .btn-check[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:#198754}  .alarm-alert{--ion-text-color: #333}  .alarm-alert .alert-wrapper{border:2px solid #eb445a;box-shadow:0 0 20px #eb445a80}  .alarm-alert .alert-head h2{color:#eb445a;font-weight:900;text-transform:uppercase}"]});let a=s;return a})();export{Le as Tab2Page};
